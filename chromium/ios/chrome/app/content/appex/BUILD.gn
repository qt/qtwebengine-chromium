# Copyright 2024 The Chromium Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/apple/compile_entitlements.gni")
import("//build/apple/tweak_info_plist.gni")
import("//build/config/ios/rules.gni")
import("//ios/build/chrome_build.gni")
import("//ios/build/config.gni")

tweak_info_plist("tweak_content_process_plist") {
  info_plist = "//content/app/ios/appex/content_process.plist"
}

tweak_info_plist("tweak_network_process_plist") {
  info_plist = "//content/app/ios/appex/network_process.plist"
}
tweak_info_plist("tweak_gpu_process_plist") {
  info_plist = "//content/app/ios/appex/gpu_process.plist"
}

compile_entitlements("chrome_content_process_entitlements") {
  substitutions = [ "IOS_BUNDLE_ID_PREFIX=$ios_app_bundle_id_prefix" ]
  output_name = "$target_gen_dir/chrome_content_process.appex.entitlements"
  entitlements_templates =
      [ "//content/app/ios/appex/content_process.appex.entitlements" ]
}

compile_entitlements("chrome_network_process_entitlements") {
  substitutions = [ "IOS_BUNDLE_ID_PREFIX=$ios_app_bundle_id_prefix" ]
  output_name = "$target_gen_dir/chrome_network_process.appex.entitlements"
  entitlements_templates =
      [ "//content/app/ios/appex/network_process.appex.entitlements" ]
}

compile_entitlements("chrome_gpu_process_entitlements") {
  substitutions = [ "IOS_BUNDLE_ID_PREFIX=$ios_app_bundle_id_prefix" ]
  output_name = "$target_gen_dir/chrome_gpu_process.appex.entitlements"
  entitlements_templates =
      [ "//content/app/ios/appex/gpu_process.appex.entitlements" ]
}

ios_appex_bundle("chrome_content_process") {
  output_name = "chrome_content_process"

  ldflags = [ "-Wl,--ignore-auto-link-option=CoreAudioTypes" ]

  deps = [
    "//content/app/ios/appex:content_process",
    "//content/public/app",
    "//ios/web/content/init",
  ]

  bundle_deps = [ "//ios/chrome/app/resources" ]

  entitlements_target = ":chrome_content_process_entitlements"
  info_plist_target = ":tweak_content_process_plist"
  bundle_identifier = "$ios_chromium_bundle_id.ContentProcess"
}

ios_appex_bundle("chrome_network_process") {
  output_name = "chrome_network_process"

  ldflags = [ "-Wl,--ignore-auto-link-option=CoreAudioTypes" ]

  deps = [
    "//content/app/ios/appex:network_process",
    "//content/public/app",
    "//ios/web/content/init",
  ]

  bundle_deps = [ "//ios/chrome/app/resources" ]

  entitlements_target = ":chrome_network_process_entitlements"
  info_plist_target = ":tweak_network_process_plist"
  bundle_identifier = "$ios_chromium_bundle_id.NetworkProcess"
}

ios_appex_bundle("chrome_gpu_process") {
  output_name = "chrome_gpu_process"

  ldflags = [ "-Wl,--ignore-auto-link-option=CoreAudioTypes" ]

  deps = [
    "//content/app/ios/appex:gpu_process",
    "//content/public/app",
    "//ios/web/content/init",
  ]

  bundle_deps = [ "//ios/chrome/app/resources" ]

  entitlements_target = ":chrome_gpu_process_entitlements"
  info_plist_target = ":tweak_gpu_process_plist"
  bundle_identifier = "$ios_chromium_bundle_id.GPUProcess"
}
